
[ ТЗ: Разработать программу для EDSAC, реализующую циклический сдвиг массива чисел ]
[ на заданное количество разрядов влево, и предполагающую загрузчик IO2. ]
[ Массив хранится в ячейках 132-136 ]
[ Количество сдвигов хранится в ячейке 131 ]
[ результат сохраняется на месте исходного массива ячейки 132-136 ]
[ ячейки 0-4 рабочие ]


         T 56 K                 [ директива IO2, установка адреса загрузки ]
         G    K                 [ директива IO2, фиксация начального адреса подпрограммы ]
[ 0:]    A 3 F                  [ пролог: формирование кода инструкции возврата в Acc ]
[ 1:]    T 58 @                 [ пролог: запись инструкции возврата ]

[ 2:]  A 4 F                    [ загрузка в аккумулятор длины обрабатываемого массива ]
[ 3:]  U 62 [len:] @            [ запись этого значения в ячейку 56+58 ]
[ 4:]  L0D                      [ сдвиг аккумулятора на 1 разряд влево ]
[ 5:]  T 61 [cLen:] @           [ запись этого значения в ячейку 56+57 ]

[ 6:]    A 0 F                  [ загрузка в аккумулятор адреса 0-го элемента массива ]
[ 7:]    A 26[r1] @             [ прибавляем код инструкции с нулевым полем адреса ]
[ 8:]    T 26[r1] @             [ запись сформированной инструкции, обнуление аккумулятора ]

[ 9:]    A 0 F                  [ загрузка в аккумулятор адреса 0-го элемента массива ]
[10:]    A 28[r2] @             [ прибавляем код инструкции с полем адреса 1 ]
[11:]    T 28[r2] @             [ запись сформированной инструкции, обнуление аккумулятора ]

[12:]    A 0 F                  [ загрузка в аккумулятор адреса 0-го элемента массива ]
[13:]    A 29[w1] @             [ прибавляем код инструкции с нулевым полем адреса ]
[14:]    T 29[w1] @             [ запись сформированной инструкции, обнуление аккумулятора ]

[15:]    A 0 F                  [ загрузка в аккумулятор адреса 0-го элемента массива ]
[16:]    A 31[w2] @             [ прибавляем код инструкции с полем адреса 1 ]
[17:]    T 31[w2] @             [ запись сформированной инструкции, обнуление аккумулятора ]

    [loop1:]
[18:]    A 2[count:] F         [ загружаем счетчик необработанных шдвигов массива ]
[19:]    S 60[c1:] @           [ уменьшаем на 1 ]
[20:]    G 57[exit:] @         [ если результат меньше 0, завершаем работу ]
[21:]    T 2[count:] F         [ обновляем значение счетчика и обнуляем аккумулятор ]

             [loop2:]
[22:]            A 4[length:] F    [ загружаем счетчик необработанных cдвигов массива ]
[23:]            S 60[c1:] @       [ уменьшаем на 1 ]
[24:]            G 41[loop1:] @    [ если результат меньше 0, завершаем работу ]
[25:]            T 4[length:] F    [ обновляем значение счетчика и обнуляем аккумулятор ]

[26:] [r1:]      A 0[addr:]F       [ загрузка в аккумулятор значения из ячейки N ]
[27:]            T 0 F             [ запись этого значения в рабочую ячейку, обнуление аккумулятора ]
[28:] [r2:]      A 1[addr +1] F    [ загрузка в аккумулятор значения из ячейки N+1 ]
[29:] [w1:]      T 0[addr:] F      [ запись этого значения в ячейку с адресом N, обнуление аккумулятора ]
[30:]            A 0 F             [ загрузка в аккумулятор значения из ячейки 0 ]
[31:] [w2:]      T 1[addr +1] F    [ запись этого значения в ячейку с адресом N+1, обнуление аккумулятора ]

[32:]            A 28[r2:] @       [ загрузка в аккумулятор инструкции r2 ]
[33:]            U 26[r1:] @       [ запись этой инструкции вместо r1 ]
[34:]            A 59[c2:] @       [ прибавляем константу 2]
[35:]            T 28[r2:] @       [ запись полученной инструкции r2 ]

[36:]            A 31[w2:] @       [ загрузка в аккумулятор инструкции w2 ]
[37:]            U 29[w1:] @       [ запись этой инструкции вместо w1 ]
[38:]            A 59[c2:] @       [ прибавляем константу 2]
[39:]            T 31[w2:] @       [ запись полученной инструкции w2 ]
[40:]            E 22[loop2:] @    [ повторяем все операции; аккумулятор обнулен ]

[41:]         T 5 F                [acc = 0]
[42:]         A 62[len:] @         [ загрузка в аккумулятор длины обрабатываемого массива ]
[43:]         T 4 F                [ запись этого значения в ячейку 4 ]

[44:]    A 26[<r1>]@               [ загрузка в аккумулятор кода инструкции с нулевым полем адреса ]
[45:]    S 61[<cLen>]@             [ возвращаем "каретку" в начало массива ]
[46:]    T 26[<r1>]@               [ запись сформированной инструкции, обнуление аккумулятора ]

[47:]    A 29[<w1>]@               [ загрузка в аккумулятор кода инструкции с нулевым полем адреса ]
[48:]    S 61[<cLen>]@             [ возвращаем "каретку" в начало массива ]
[49:]    T 29[<w1>]@               [ запись сформированной инструкции, обнуление аккумулятора ]

[50:]    A 28[<r2>]@               [ загрузка в аккумулятор кода инструкции с первым полем адреса ]
[51:]    S 61[<cLen>]@             [ возвращаем "каретку" в начало массива ]
[52:]    T 28[<r2>]@               [ запись сформированной инструкции, обнуление аккумулятора ]

[53:]    A 31[<w2>]@               [ загрузка в аккумулятор кода инструкции с первым полем адреса ]
[54:]    S 61[<cLen>]@             [ возвращаем "каретку" в начало массива ]
[55:]    T 31[<w2>]@               [ запись сформированной инструкции, обнуление аккумулятора ]
[56:]    E 18[loop1:] @            [ повторяем все операции; аккумулятор обнулен ]
      [exit:]
[57:]        T 0 F                 [ обнуление аккумулятора ]
      [ret:]
[58:]        E 0 F                 [ эпилог: инструкция возврата из подпрограммы ]
      [const:]
[59:] [c2:]   P 1 F                [2]
[60:] [c1:]   P 0 D                [1]
[61:] [cLen:] P 0 F                [0]
[62:] [len:]  P 0 F                [0]

       G K              [ директива IO2, фиксация начального адреса программы ]
[ 0:] Z 0 F
[ 1:] A 10  [ADDR:] @   [ адрес начала массива ]
[ 2:] T 0 F             [ запись адреса массива в ячейку 0, обнуление аккумулятора ]
[ 3:] A 11  [<len>] @   [ длина массива ]
[ 4:] T 4 F             [ запись длины массива в ячейку 4, обнуление аккумулятора ]
[ 5:] A 12  [COUNT] @   [ счетчик ]
[ 6:] T 2 F             [ запись счетчика в ячейку 2, обнуление аккумулятора ]
[ 7:] A 7 @             [\ вызов        ]
[ 8:] G 56  [<sub>] F   [/ подпрограммы ]
[ 9:] Z 0 F             [ останов ]

     [ADDR:]
[10:]  P 13 [<array>] @ [ адрес массива = <Начало программы>+13 (см. ниже) ]
     [LEN:]
[11:] P 2 F            [ длина массива - 5 (0…0|0|0…101|1 = 5) ]
     [COUNT:]
[12:] P 1 D  [ 3 ]     [количество сдвигов в массиве чисел]
     [array:]
[13:] P 0 D [ 1 ]
[14:] P 1 F [ 2 ]
[15:] P 1 D [ 3 ]
[16:] P 2 F [ 4 ]
[17:] P 2 D [ 5 ]
      EZ PF            [директива IO2,переход в исполнению ]
